# [101755G - Underpalindromity](https://codeforces.com/gym/101755/problem/G)

> Ch√∫ √Ω: Index ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn d∆∞·ªõi ƒë√¢y l√† 1-based nh√© ‚ö†

## M·ªôt s·ªë nh·∫≠n x√©t nho nh·ªè hehe (‚Äæ‚ó°‚óù)
  - Gi·∫£ s·ª≠ ta c√≥ m·ªôt m·∫£ng `a` c√≥ ƒë·ªô d√†i `k`, n·∫øu ta bi·∫øt ƒë∆∞·ª£c ch·ªâ s·ªë `i` c·ªßa m·ªôt ph·∫ßn t·ª≠ b·∫•t k√¨ th√¨ ta c≈©ng d·∫Ω d√†ng bi·∫øt ƒë∆∞·ª£c ph·∫ßn t·ª≠ ƒë·ªëi x·ª©ng v·ªõi n√≥ c√≥ ch·ªâ s·ªë l√† `k - i + 1`
  - X√©t t√≠nh ch·∫µn l·∫ª c·ªßa ƒë·ªô d√†i `k`
    + N·∫øu `k` l√† ch·∫µn th√¨ `i` v√† `k - i + 1` kh√°c t√≠nh ch·∫µn l·∫ª
    + N·∫øu `k` l√† l·∫ª th√¨ `i` v√† `k - i + 1` c√πng t√≠nh ch·∫µn l·∫ª

## √ù t∆∞·ªüng üß†
  - Duy·ªát l·∫ßn l∆∞·ª£t c√°c ph·∫ßn t·ª≠ theo th·ª© t·ª± tƒÉng d·∫ßn
  - S·ª≠ d·ª•ng 4 c√¢y BIT:
    + 2 c√¢y ƒë·ªÉ l∆∞u gi√° tr·ªã c·ªßa c√°c ph·∫ßn t·ª≠ ƒë√£ duy·ªát qua ·ªü ch·ªâ s·ªë ch·∫µn v√† l·∫ª ri√™ng bi·ªát
    + 2 c√¢y ƒë·ªÉ ƒë√°nh d·∫•u c√°c ph·∫ßn t·ª≠ ƒë√£ duy·ªát qua ·ªü ch·ªâ s·ªë ch·∫µn v√† l·∫ª ri√™ng bi·ªát
  - C√≥ 4 tr∆∞·ªùng h·ª£p:
    + ƒê·ªô d√†i `k` l√† l·∫ª v√† ch·ªâ s·ªë `i` l√† l·∫ª: Gi√° tr·ªã c·ªßa `b[i]` ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c v·ªã tr√≠ l·∫ª
    + ƒê·ªô d√†i `k` l√† l·∫ª v√† ch·ªâ s·ªë `i` l√† ch·∫µn: Gi√° tr·ªã c·ªßa `b[i]` ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c v·ªã tr√≠ ch·∫µn
    + ƒê·ªô d√†i `k` l√† ch·∫µn v√† ch·ªâ s·ªë `i` l√† ch·∫µn: Gi√° tr·ªã c·ªßa `b[i]` ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c v·ªã tr√≠ l·∫ª
    + ƒê·ªô d√†i `k` l√† ch·∫µn v√† ch·ªâ s·ªë `i` l√† l·∫ª: Gi√° tr·ªã c·ªßa `b[i]` ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c v·ªã tr√≠ ch·∫µn
    + _**Hay ƒë∆°n gi·∫£n l√† n·∫øu `k` v√† `i` c√πng t√≠nh ch·∫µn l·∫ª th√¨ `b[i]` ·∫£nh h∆∞·ªüng ƒë·∫øn v·ªã tr√≠ l·∫ª, kh√¥ng th√¨ l√† ch·∫µn**_
  - V·∫•n ƒë·ªÅ quan tr·ªçng n·ªØa l√† v·ªã tr√≠ ·∫£nh h∆∞·ªüng c·ªßa `b[i]` t·∫°m g·ªçi l√† `low` v√† `high` th√¨ ta c√≥: 
    + `low = max(0, i - k) * 2 + k - 1 - i`
    + `high = min(n, i + k - 1) * 2 + k + 1 - i`
    + _**Kh√¥ng nh·ªõ t·∫°i sao (¬¥„ÄÇÔºø„ÄÇÔΩÄ) khi n√†o nh·ªõ th√¨ ghi v·∫≠y**_

## Code n√® üå≠
  - ƒê√£ s·ª≠a l·∫°i m·ªôt ch√∫t cho tinh t·∫ø ( Õ°~ Õú ñ Õ°¬∞)
```c++
#include <bits/stdc++.h>
using namespace std;

#define val first
#define pos second
#define pi pair<int, int>
#define int long long

const int maxn = 2e5 + 5;

int n, k, res;
pi a[maxn];

int bit[2][2][maxn + 1];

void update(int par, int type, int u, int val){
    while(u <= n){
        bit[par][type][u] += val;
        u += u & -u;
    }
}

int sum(int par, int type, int u){
    if(!u) return 0;
    int r = 0;
    while(u){
        r += bit[par][type][u];
        u -= u & -u;
    }
    return r;
}

signed main(){
    ios_base::sync_with_stdio(false); cin.tie(0); cout.tie(0);

    cin >> n >> k;

    for(int i = 1; i <= n; i++)
        cin >> a[i].val, a[i].pos = i;

    sort(a + 1, a + n + 1);

    for(int i = 1; i <= n; i++){
        int low = max(0ll, a[i].pos - k) * 2 + k + 1 - a[i].pos, high = (min(n, a[i].pos + k - 1) - k) * 2 + k + 1 - a[i].pos;
        int par = !((k % 2) ^ (a[i].pos % 2));

        int q = sum(par, 1, high) - sum(par, 1, low - 1);
        int s = sum(par, 0, high) - sum(par, 0, low - 1);

        update(a[i].pos % 2, 1, a[i].pos, 1);
        update(a[i].pos % 2, 0, a[i].pos, a[i].val);

        res += a[i].val * q - s;
    }

    cout << res;
}
```
  - Gi·∫£ th√≠ch qua m·ªôt ch√∫t ·ªü `bit[i][j][u]`: üëå
    + `i = 0` l√† c√¢y BIT c·ªßa ch·ªâ s·ªë ch·∫µn, v√† ng∆∞·ª£c l·∫°i v·ªõi `i = 1`
    + `j = 0` l√† c√¢y BIT cho vi·ªác l∆∞u t·ªïng v√† `j = 1` l√† c√¢y BIT cho vi·ªác ƒë√°nh d·∫•u ph·∫ßn t·ª≠ ƒë√£ duy·ªát
<br></br>
###  _**Thanks for reading, and remember, your waifu is real and she loves you.**_ - [Ari](https://codeforces.com/profile/Ari)
    
<img src = "https://github.com/LetterC67/public_archieve/blob/main/misc/pic/197294418_161645395982523_7700461171824066749_n.jpg" width = 400>
