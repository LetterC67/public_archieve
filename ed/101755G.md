# [101755G - Underpalindromity](https://codeforces.com/gym/101755/problem/G)

> ChÃº Ã½: Index Ä‘Æ°á»£c nháº¯c Ä‘áº¿n dÆ°á»›i Ä‘Ã¢y lÃ  1-based nhÃ© âš 

## Má»™t sá»‘ nháº­n xÃ©t nho nhá» hehe (â€¾â—¡â—)
  - Giáº£ sá»­ ta cÃ³ má»™t máº£ng `a` cÃ³ Ä‘á»™ dÃ i `k`, náº¿u ta biáº¿t Ä‘Æ°á»£c chá»‰ sá»‘ `i` cá»§a má»™t pháº§n tá»­ báº¥t kÃ¬ thÃ¬ ta cÅ©ng dáº½ dÃ ng biáº¿t Ä‘Æ°á»£c pháº§n tá»­ Ä‘á»‘i xá»©ng vá»›i nÃ³ cÃ³ chá»‰ sá»‘ lÃ  `k - i + 1`
  - XÃ©t tÃ­nh cháºµn láº» cá»§a Ä‘á»™ dÃ i `k`
    + Náº¿u `k` lÃ  cháºµn thÃ¬ `i` vÃ  `k - i + 1` khÃ¡c tÃ­nh cháºµn láº»
    + Náº¿u `k` lÃ  láº» thÃ¬ `i` vÃ  `k - i + 1` cÃ¹ng tÃ­nh cháºµn láº»

## Ã tÆ°á»Ÿng ğŸ§ 
  - Duyá»‡t láº§n lÆ°á»£t cÃ¡c pháº§n tá»­ theo thá»© tá»± tÄƒng dáº§n
  - Sá»­ dá»¥ng 4 cÃ¢y BIT:
    + 2 cÃ¢y Ä‘á»ƒ lÆ°u giÃ¡ trá»‹ cá»§a cÃ¡c pháº§n tá»­ Ä‘Ã£ duyá»‡t qua á»Ÿ chá»‰ sá»‘ cháºµn vÃ  láº» riÃªng biá»‡t
    + 2 cÃ¢y Ä‘á»ƒ Ä‘Ã¡nh dáº¥u cÃ¡c pháº§n tá»­ Ä‘Ã£ duyá»‡t qua á»Ÿ chá»‰ sá»‘ cháºµn vÃ  láº» riÃªng biá»‡t
  - CÃ³ 4 trÆ°á»ng há»£p:
    + Äá»™ dÃ i `k` lÃ  láº» vÃ  chá»‰ sá»‘ `i` lÃ  láº»: GiÃ¡ trá»‹ cá»§a `b[i]` áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c vá»‹ trÃ­ láº»
    + Äá»™ dÃ i `k` lÃ  láº» vÃ  chá»‰ sá»‘ `i` lÃ  cháºµn: GiÃ¡ trá»‹ cá»§a `b[i]` áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c vá»‹ trÃ­ cháºµn
    + Äá»™ dÃ i `k` lÃ  cháºµn vÃ  chá»‰ sá»‘ `i` lÃ  cháºµn: GiÃ¡ trá»‹ cá»§a `b[i]` áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c vá»‹ trÃ­ láº»
    + Äá»™ dÃ i `k` lÃ  cháºµn vÃ  chá»‰ sá»‘ `i` lÃ  láº»: GiÃ¡ trá»‹ cá»§a `b[i]` áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c vá»‹ trÃ­ cháºµn
    + _**Hay Ä‘Æ¡n giáº£n lÃ  náº¿u `k` vÃ  `i` cÃ¹ng tÃ­nh cháºµn láº» thÃ¬ `b[i]` áº£nh hÆ°á»Ÿng Ä‘áº¿n vá»‹ trÃ­ láº», khÃ´ng thÃ¬ lÃ  cháºµn**_
  - Váº¥n Ä‘á» quan trá»ng ná»¯a lÃ  vá»‹ trÃ­ áº£nh hÆ°á»Ÿng cá»§a `b[i]` táº¡m gá»i lÃ  `low` vÃ  `high` thÃ¬ ta cÃ³: 
    + `low = max(0, i - k) * 2 + k - 1 - i`
    + `high = min(n, i + k - 1) * 2 + k + 1 - i`
    + _**KhÃ´ng nhá»› táº¡i sao (Â´ã€‚ï¼¿ã€‚ï½€)**_

## Code nÃ¨ ğŸŒ­
  - ÄÃ£ sá»­a láº¡i má»™t chÃºt cho tinh táº¿ ( Í¡~ ÍœÊ– Í¡Â°)
```c++
#include <bits/stdc++.h>
using namespace std;

#define val first
#define pos second
#define pi pair<int, int>
#define int long long

const int maxn = 2e5 +5;

int n, k, res;
pi a[maxn];

int bit[2][2][maxn + 1];

void update(int par, int type, int u, int val){
    while(u <= n){
        bit[par][type][u] += val;
        u += u & -u;
    }
}

int sum(int par, int type, int u){
    if(u == 0) return 0;
    int r = 0;
    while(u){
        r += bit[par][type][u];
        u -= u & -u;
    }
    return r;
}

signed main(){
    ios_base::sync_with_stdio(false); cin.tie(0); cout.tie(0);

    cin >> n >> k;

    for(int i = 1; i <= n; i++)
        cin >> a[i].val, a[i].pos = i;

    sort(a + 1, a + n + 1);

    for(int i = 1; i <= n; i++){
        int low = max(0ll, a[i].pos - k) * 2 + k + 1 - a[i].pos, high = (min(n, a[i].pos + k - 1) - k) * 2 + k + 1 - a[i].pos;
        int par = !((k % 2) ^ (a[i].pos % 2));

        int q = sum(par, 1, high) - sum(par, 1, low - 1);
        int s = sum(par, 0, high) - sum(par, 0, low - 1);

        update(a[i].pos % 2, 1, a[i].pos, 1);
        update(a[i].pos % 2, 0, a[i].pos, a[i].val);

        res += a[i].val * q - s;
    }

    cout << res;
}
```
  - Giáº£ thÃ­ch qua má»™t chÃºt á»Ÿ `bit[i][j][u]`: ğŸ‘Œ
    + `i = 0` lÃ  cÃ¢y BIT cá»§a chá»‰ sá»‘ cháºµn, vÃ  ngÆ°á»£c láº¡i vá»›i `i = 1`
    + `j = 0` lÃ  cÃ¢y BIT cho viá»‡c lÆ°u tá»•ng vÃ  `j = 1` lÃ  cÃ¢y BIT cho viá»‡c Ä‘Ã¡nh dáº¥u pháº§n tá»­ Ä‘Ã£ duyá»‡t

_**Thanks for reading, and remember, your waifu is real and she loves you.**_ - [Ari](https://codeforces.com/profile/Ari)
    
